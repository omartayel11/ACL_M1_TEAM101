// 1. Retrieve the count of travellers who have visited a country where they don't need a visa. Include domestic travel (travellers visiting their own country) in the results.
// Answer: 1999
MATCH (t:Traveller)-[:FROM_COUNTRY]->(fromCountry:Country)
MATCH (t)-[:STAYED_AT]->(h:Hotel)-[:LOCATED_IN]->(c:City)-[:LOCATED_IN]->(toCountry:Country)
WHERE NOT (fromCountry)-[:NEEDS_VISA]->(toCountry)
RETURN COUNT(DISTINCT t) AS traveller_count


// 2. Retrieve the top 3 hotels with the highest average ratings for Business travellers. The average rating should be calculated as the average of score_overall from all reviews written by Business travellers for each hotel.
MATCH (t:Traveller {type: 'Business'})-[:WROTE]->(r:Review)-[:REVIEWED]->(h:Hotel)
WITH h, AVG(r.score_overall) AS avg_rating
ORDER BY avg_rating DESC
LIMIT 3
RETURN h.name AS hotel_name, avg_rating


// 3. Return the number of couple travellers who stayed at each hotel. Include all hotels in the results, even those with 0 couple travellers (show count as 0). Sort by Hotel name.
MATCH (h:Hotel)
OPTIONAL MATCH (t:Traveller {type: 'Couple'})-[:STAYED_AT]->(h)
WITH h, COUNT(DISTINCT t) AS couple_count
ORDER BY h.name
RETURN h.name AS hotel_name, couple_count


// 4. Return the top 3 hotels with an average review cleanliness below 8.8. Sort by the average review cleanliness in ascending order.
MATCH (r:Review)-[:REVIEWED]->(h:Hotel)
WITH h, AVG(r.score_cleanliness) AS avg_cleanliness
WHERE avg_cleanliness < 8.8
ORDER BY avg_cleanliness ASC
LIMIT 3
RETURN h.name AS hotel_name, avg_cleanliness


// 5. Return all hotels with the highest scores for locations for women, using the average score_location from reviews (include all ties).
MATCH (t:Traveller {gender: 'Female'})-[:WROTE]->(r:Review)-[:REVIEWED]->(h:Hotel)
WITH h, AVG(r.score_location) AS avg_location_score
WITH MAX(avg_location_score) AS max_score
MATCH (t2:Traveller {gender: 'Female'})-[:WROTE]->(r2:Review)-[:REVIEWED]->(h2:Hotel)
WITH h2, AVG(r2.score_location) AS avg_location_score, max_score
WHERE avg_location_score = max_score
RETURN h2.name AS hotel_name, avg_location_score



