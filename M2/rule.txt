// EXCEEDS EXPECTATIONS RULE
// A hotel is said to "exceed expectations" when the sum of its base quality scores is greater than or equal to the average of the review scores from a specific demographic group of travellers.
// For each demographic group (age group), focus on Solo Female travellers, while noting that for women travelling alone, the main concern would be the cleanliness and comfort of the hotel and the facilities they provide.
// Calculate: Minimum, Maximum, and Average Improvement Percentage for hotels that exceed expectations per age group.
// First row answer: age_group='18-24', min_improve=1.7, max_improve=4.8, avg_improve=3.51

MATCH (t:Traveller {gender: 'Female', type: 'Solo'})-[:WROTE]->(r:Review)-[:REVIEWED]->(h:Hotel)
WITH t.age AS age_group, h, 
     h.cleanliness_base + h.comfort_base + h.facilities_base AS base_sum,`  
     AVG(r.score_cleanliness + r.score_comfort + r.score_facilities) AS avg_review_sum
WITH age_group, h, base_sum, avg_review_sum,
     ((base_sum - avg_review_sum) / avg_review_sum) * 100 AS improvement_percentage
WHERE base_sum >= avg_review_sum
WITH age_group, 
     MIN(improvement_percentage) AS min_improve,
     MAX(improvement_percentage) AS max_improve,
     AVG(improvement_percentage) AS avg_improve
ORDER BY age_group
RETURN age_group, 
       ROUND(min_improve * 100) / 100 AS min_improve, 
       ROUND(max_improve * 100) / 100 AS max_improve, 
       ROUND(avg_improve * 100) / 100 AS avg_improve